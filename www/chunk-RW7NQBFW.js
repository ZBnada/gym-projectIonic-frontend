import{b as a,e as o,g as i,h as l,oa as c}from"./chunk-WCEPOSQX.js";var s=function(r){return r.ADMIN="ADMIN",r.CLIENT="CLIENT",r}(s||{});var S=(()=>{class r{constructor(e){this.http=e,this.apiUrl="http://localhost:8091/api/users",this.currentUserSubject=new a(null),this.currentUser$=this.currentUserSubject.asObservable(),this.loadUserFromStorage()}loadUserFromStorage(){let e=localStorage.getItem("currentUser");if(e)try{let t=JSON.parse(e);this.currentUserSubject.next(t)}catch(t){console.error("Error parsing user from localStorage:",t),localStorage.removeItem("currentUser"),localStorage.removeItem("token")}}getCurrentUser(){return this.currentUserSubject.value}decodeToken(e){try{let t=e.split(".")[1];return JSON.parse(atob(t))}catch(t){return console.error("Error decoding token:",t),null}}getUserInfoFromToken(){let e=localStorage.getItem("token");if(!e)return null;let t=this.decodeToken(e);return t?{firstName:t.firstName||t.sub,lastName:t.lastName||"",email:t.email||t.sub,role:t.role||s.CLIENT}:null}updateUserInfo(e){this.currentUserSubject.next(e),localStorage.setItem("currentUser",JSON.stringify(e))}getUserByEmail(e){return this.http.get(`${this.apiUrl}/${e}`)}signup(e){return this.http.post(`${this.apiUrl}/signup`,e,{responseType:"text"})}login(e,t){return this.http.post(`${this.apiUrl}/login`,{email:e,pwd:t}).pipe(o(n=>{n.token&&(localStorage.setItem("token",n.token),this.getUserByEmail(e).subscribe(u=>{this.updateUserInfo(u)}))}))}logout(){localStorage.removeItem("token"),localStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}isLoggedIn(){return!!localStorage.getItem("token")}getRole(){let e=this.currentUserSubject.value;return e?e.role:null}refreshUserData(){let e=this.getCurrentUser();if(!e||!e.email)throw new Error("No user email available");return this.getUserByEmail(e.email).pipe(o(t=>this.updateUserInfo(t)))}static{this.\u0275fac=function(t){return new(t||r)(l(c))}}static{this.\u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{s as a,S as b};
