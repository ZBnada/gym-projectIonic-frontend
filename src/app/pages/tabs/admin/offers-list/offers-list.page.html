<ion-header [translucent]="true">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-button>
        <ion-icon name="menu-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="gym-title">
      <div class="title-content">
        <div class="logo-section">
          <ion-icon name="barbell" class="title-icon"></ion-icon>
          <span class="gym-name">GYM Pro</span>
        </div>
        <span class="page-title"> Offres</span>
      </div>
    </ion-title>

    <ion-buttons slot="end">
      <!-- Bouton ajouter offre -->
      <ion-button (click)="navigateToAddOffer()" fill="clear" class="add-button">
        <ion-icon name="person-add-outline" slot="icon-only"></ion-icon>
      </ion-button>
      
      <!-- Bouton notifications -->
      <ion-button (click)="openNotifications()" fill="clear">
        <ion-badge color="danger" *ngIf="unreadNotifications() > 0" class="notification-badge">
          {{unreadNotifications()}}
        </ion-badge>
        <ion-icon name="notifications" slot="icon-only" color="warning"></ion-icon>
      </ion-button>

      <!-- Avatar utilisateur avec dropdown menu -->
      <ion-button fill="clear" (click)="openUserMenu($event)" class="user-avatar-button">
        @if (hasUserPhoto()) {
          <ion-avatar class="header-avatar">
            <img 
              [src]="getUserPhoto()" 
              alt="User" 
              (error)="handleImageError($event)"
              onerror="this.style.display='none'"
            />
          </ion-avatar>
        } @else {
          <ion-avatar class="header-avatar-icon">
            <ion-icon name="person-circle-outline" color="warning"></ion-icon>
          </ion-avatar>
        }
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Barre de recherche et contrôles -->
  <ion-toolbar color="light">
    <ion-grid class="controls-grid">
      <ion-row class="controls-row">
        <ion-col size="12" size-md="6">
          <div class="show-entries">
            <span>Show</span>
            <ion-select 
              [value]="entriesPerPage()" 
              (ionChange)="onEntriesPerPageChange($event)"
              interface="popover"
              class="entries-select">
              <ion-select-option value="5">5</ion-select-option>
              <ion-select-option value="10">10</ion-select-option>
              <ion-select-option value="25">25</ion-select-option>
              <ion-select-option value="50">50</ion-select-option>
            </ion-select>
          </div>
        </ion-col>
        
        <ion-col size="12" size-md="6">
          <ion-searchbar 
            placeholder="Search offers..."
            (ionInput)="onSearchChange($event)"
            animated
            clear-icon="close-circle"
            class="table-searchbar">
          </ion-searchbar>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="table-content">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Loading offers...</p>
    </div>
  }

  <!-- Table Container -->
  @if (!isLoading()) {
    <div class="table-container">
      <!-- Table -->
      <div class="table-wrapper">
        <table class="offers-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Product</th>
              <th>Description</th>
              <th>Duration</th>
              <th>Packaging</th>
              <th>Price</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (offer of paginatedOffers; track offer.id; let i = $index) {
              <!-- Ligne cliquable pour voir les détails -->
              <tr class="table-row clickable-row" (click)="viewOfferDetails(offer)">
                <td class="index-cell">{{ getDisplayRange().start + i }}</td>
                <td class="product-cell">
                  <div class="product-info">
                    <strong class="product-name">{{ offer.titre }}</strong>
                  </div>
                </td>
                <td class="description-cell">
                  <span class="description-text">{{ offer.description }}</span>
                </td>
                <td class="duration-cell">
                  <span class="duration-badge">{{ offer.dureeMois }} months</span>
                </td>
                <td class="packaging-cell">
                  <span class="packaging-text">Standard</span>
                </td>
                <td class="price-cell">
                  <strong class="price-amount">{{ offer.prix }} DT</strong>
                </td>
                <td class="status-cell">
                  <span class="status-badge active">Active</span>
                </td>
                <td class="actions-cell">
                  <div class="actions-container" (click)="$event.stopPropagation()">
                    <!-- Bouton Édition (Jaune) -->
                    <ion-button 
                      fill="clear" 
                      size="small" 
                      class="action-btn edit-btn"
                      (click)="openEditOffer(offer)">
                      <ion-icon name="create-outline" slot="icon-only" color="warning"></ion-icon>
                    </ion-button>
                    
                    <!-- Bouton Suppression (Rouge) -->
                    <ion-button 
                      fill="clear" 
                      size="small" 
                      class="action-btn delete-btn"
                      (click)="deleteOffer(offer)">
                      <ion-icon name="trash-outline" slot="icon-only" color="danger"></ion-icon>
                    </ion-button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      @if (filteredOffers().length === 0) {
        <div class="empty-table">
          <ion-icon name="document-outline" class="empty-icon"></ion-icon>
          <h3>No offers found</h3>
          <p>No offers match your search criteria</p>
        </div>
      }

      <!-- Pagination -->
      @if (filteredOffers().length > 0) {
        <div class="pagination-container">
          <div class="pagination-info">
            Showing {{ getDisplayRange().start }} to {{ getDisplayRange().end }} of {{ filteredOffers().length }} entries
          </div>
          
          <div class="pagination-controls">
            <ion-button 
              fill="clear" 
              size="small" 
              [disabled]="currentPage() === 1"
              (click)="prevPage()">
              Previous
            </ion-button>
            
            @for (page of [].constructor(totalPages); track page; let i = $index) {
              <ion-button 
                fill="clear" 
                size="small" 
                [color]="currentPage() === i + 1 ? 'primary' : 'medium'"
                (click)="goToPage(i + 1)">
                {{ i + 1 }}
              </ion-button>
            }
            
            <ion-button 
              fill="clear" 
              size="small" 
              [disabled]="currentPage() === totalPages"
              (click)="nextPage()">
              Next
            </ion-button>
          </div>
        </div>
      }
    </div>
  }

  <!-- Floating Action Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button color="dark" (click)="navigateToAddOffer()">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>